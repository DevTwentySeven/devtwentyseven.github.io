<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Watchlist</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: 'Courier New', monospace;
    }
    .ticker-bar {
      display: flex;
      align-items: center;
      overflow: hidden;
      white-space: nowrap;
      background: #000;
      border-bottom: 1px solid #00ff00;
      height: 30px;
    }
    .ticker-content {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 30s linear infinite;
    }
    .token {
      display: inline-flex;
      align-items: center;
      margin: 0 2rem;
      cursor: pointer;
    }
    .token img {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .token span {
      margin: 0 5px;
    }
    .positive { color: #00ff00; }
    .negative { color: #ff3333; }

    @keyframes scroll-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
  </style>
</head>
<body>
  <div class="ticker-bar">
    <div id="ticker" class="ticker-content">Carregando...</div>
  </div>

  <script>
    // Lista de tokens Solana (contract address)
    const tokens = [
      "So11111111111111111111111111111111111111112", // SOL
      "9A2jUbgoDY97fruKHXvDd7eQiq4xvnW3By1BfH1Bwn9Y", // DEEP
      "J3oWJafxg8xmH5vvwBAVX99rmr8b7C9BxjmjaMgCpump", // MAHA
      "AtPNZ3Rwcezea16xkjkxULzCMKpSbS2rVEirVfzrnEa6", // GOLD
      "vtUzXyowSMsNUwiZMLNufySoeW9ehaPAVr7YsYQpump", // MARV
      "FRsV3m924aGpLMuEekoo3JkkMt1oopaM4JY9ki5YLXrp"  // XVM
    ];

    // Função para formatar números grandes (k / M / B)
    function formatNumber(num) {
      if (num >= 1e9) return (num / 1e9).toFixed(2) + "B";
      if (num >= 1e6) return (num / 1e6).toFixed(2) + "M";
      if (num >= 1e3) return (num / 1e3).toFixed(2) + "K";
      return num.toFixed(2);
    }

    async function loadWatchlist() {
      try {
        const url = `https://api.dexscreener.com/latest/dex/tokens/${tokens.join(",")}`;
        const res = await fetch(url);
        const data = await res.json();

        const ticker = document.getElementById("ticker");
        ticker.innerHTML = "";

        if (!data.pairs || data.pairs.length === 0) {
          ticker.innerHTML = "Nenhum dado disponível.";
          return;
        }

        data.pairs.forEach(pair => {
          const container = document.createElement("div");
          container.className = "token";

          // abre link na Dexscreener ao clicar
          container.onclick = () => {
            window.open(`https://dexscreener.com/solana/${pair.baseToken.address}`, "_blank");
          };

          // ícone
          const img = document.createElement("img");
          img.src = pair.info?.imageUrl || "https://cryptologos.cc/logos/solana-sol-logo.png"; // fallback
          container.appendChild(img);

          // ticker
          const tickerText = document.createElement("span");
          tickerText.textContent = pair.baseToken.symbol;
          container.appendChild(tickerText);

          // market cap
          const mc = document.createElement("span");
          mc.textContent = `$${formatNumber(pair.fdv || 0)}`;
          container.appendChild(mc);

          // variação 1h
          const change = document.createElement("span");
          const changeValue = pair.priceChange?.h1 || 0;
          change.textContent = (changeValue >= 0 ? "+" : "") + changeValue.toFixed(2) + "%";
          change.className = changeValue >= 0 ? "positive" : "negative";
          container.appendChild(change);

          ticker.appendChild(container);
        });

      } catch (err) {
        console.error("Erro ao carregar watchlist:", err);
        document.getElementById("ticker").textContent = "Erro ao carregar dados.";
      }
    }

    loadWatchlist();
    setInterval(loadWatchlist, 60000); // atualiza a cada 60s
  </script>
</body>
</html>
